import{n as h,r as l,u as d,a as u,Y as y,j as e,o as p,I as x,p as f,t as j}from"./index-wKudUIDS.js";import{H as g}from"./Header-BjBrTraJ.js";const N=()=>{const{coordinates:r}=h(o=>o.cities),[t,s]=l.useState(""),i=d(),n=u(),a=o=>{o.preventDefault(),t.trim()!==""&&(i(p(t)),n(`/weather/${encodeURIComponent(t.trim())}`),s(""))},c=`https://static-maps.yandex.ru/v1?lang=ru_RU&ll=${r.toString()}&spn=0.3,0.3&size=400,400&apikey=${y}`,m=o=>{s(o.target.value)};return e.jsxs("div",{className:"weather-card city-input-section",children:[e.jsx("input",{className:"input-for-city",type:"text",placeholder:"Enter city...",value:t,onChange:m}),e.jsx("button",{className:"button-enter",onClick:a,children:"Submit"}),e.jsx("img",{className:"map-city",src:c,alt:"Map"})]})},v=()=>{const{currentCity:r,temperature:t,icon:s,isLoading:i,error:n}=h(c=>c.cities);if(i)return e.jsx("div",{children:"Loading..."});if(n)return e.jsxs("div",{children:["Error: ",n]});if(!r)return e.jsx("div",{children:"Enter a city to see the weather."});const a=`https://openweathermap.org/img/wn/${s}@2x.png`;return e.jsxs("div",{className:"weather-card",children:[e.jsx("div",{className:"header-page",children:"Weather Information"}),e.jsx("div",{className:"icon-weather",children:e.jsx("img",{src:a})}),e.jsx("div",{className:"show-weather",children:t}),e.jsx("ul",{className:"info-weather",children:e.jsx("li",{className:"InfoCity",children:r})})]})},C=()=>{const r=h(a=>a.cities.historyList),t=d(),s=u(),i=a=>{t(p(a)),s(`/weather/${encodeURIComponent(a)}`)},n=r.map((a,c)=>e.jsx("li",{className:"li-history",onClick:()=>i(a),style:{cursor:"pointer"},children:a},`${a}-${c}`));return e.jsxs("div",{className:"history-card",children:[e.jsx("div",{className:"header-page",children:"History"}),e.jsx("ul",{className:"history-city",children:n})]})},w=()=>async r=>{try{const t=await fetch(`https://ipinfo.io/json?token=${x}`);if(!t.ok){console.error(`HTTP error: ${t.status}`);return}const s=await t.json();if(!s.city){console.error("City not found in response");return}r(p(s.city))}catch(t){console.error("Failed to fetch city",t)}},I=()=>d(),L=()=>{const{city:r}=f(),t=h(n=>n.cities.currentCity),s=I(),i=u();return l.useEffect(()=>{!r&&!t&&s(w())},[]),l.useEffect(()=>{t&&t!==r&&i(`/weather/${encodeURIComponent(t)}`,{replace:!0})},[t,r,i]),l.useEffect(()=>{t&&s(j())},[t,s]),e.jsxs(e.Fragment,{children:[e.jsx(g,{text:"Weather Information APP",size:1,className:"header"}),e.jsxs("div",{className:"weather-layout",children:[e.jsx(N,{}),e.jsx(v,{}),e.jsx(C,{})]})]})};export{L as Layout,L as default};
